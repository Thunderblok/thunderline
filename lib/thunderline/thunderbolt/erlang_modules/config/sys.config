%% THUNDERCELL System Configuration
%% 
%% Erlang system configuration for THUNDERCELL compute layer

[
 %% Lager logging configuration
 {lager, [
   {log_root, "log"},
   {crash_log, "crash.log"},
   {crash_log_msg_size, 65536},
   {crash_log_size, 10485760},
   {crash_log_date, "$D0"},
   {crash_log_count, 5},
   {error_logger_redirect, true},
   {error_logger_hwm, 100},
   {async_threshold, 20},
   {async_threshold_window, 5},
   
   {handlers, [
     {lager_console_backend, [
       {level, info},
       {formatter, lager_default_formatter},
       {formatter_config, [
         "[", severity, "] ",
         {pid, ""},
         {module, [
           {pid, ["@"], ""},
           module,
           {function, [":", function], ""},
           {line, [":", line], ""}
         ], ""},
         " ", message, "\n"
       ]}
     ]},
     
     {lager_file_backend, [
       {file, "thundercell.log"},
       {level, debug},
       {size, 10485760},
       {date, "$D0"},
       {count, 10}
     ]},
     
     {lager_file_backend, [
       {file, "thundercell_error.log"},
       {level, error},
       {size, 10485760},
       {date, "$D0"},
       {count, 5}
     ]}
   ]}
 ]},

 %% THUNDERCELL application configuration
 {thundercell, [
   {erlang_bridge_enabled, true},
   {thunderlane_discovery, true},
   {default_cluster_config, #{
     dimensions => {10, 10, 10},
     evolution_interval => 100,
     ca_rules => #{
       name => "Conway's Game of Life 3D",
       birth_neighbors => [5, 6, 7],
       survival_neighbors => [4, 5, 6],
       neighbor_type => moore_3d
     }
   }},
   {telemetry_enabled, true},
   {performance_monitoring, true},
   {max_clusters, 1000},
   {cluster_pool_size, 50},
   {ca_cell_pool_size, 10000}
 ]},

 %% GraphQL configuration
 {graphql, [
   {schema_file, "priv/schema.graphql"},
   {endpoint, "/graphql"},
   {introspection, true}
 ]},

 %% Mnesia database configuration
 {mnesia, [
   {dir, "mnesia"}
 ]},

 %% Kernel configuration
 {kernel, [
   {logger_level, info},
   {logger, [
     {handler, default, logger_std_h, #{
       level => info,
       formatter => {logger_formatter, #{
         single_line => false,
         template => [time, " [", level, "] ", pid, " ", mfa, ":", line, " ", msg, "\n"]
       }}
     }}
   ]}
 ]},

 %% SASL configuration  
 {sasl, [
   {sasl_error_logger, false},
   {errlog_type, error}
 ]}
].
